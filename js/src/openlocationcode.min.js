!function(e,r){"function"==typeof define&&define.amd?define(["b"],function(t){return e.returnExportsGlobal=r()}):"object"==typeof module&&module.exports?module.exports=r(require("b")):e.OpenLocationCode=r()}(this,function(){var e={CODE_PRECISION_NORMAL:10,CODE_PRECISION_EXTRA:11},r="23456789CFGHJMPQRVWX",t=r.length,n=t**4,o=t**3,i=[20,1,.05,.0025,125e-6],a=3125*o,u=1024*o;e.getAlphabet=function(){return r};var f=e.isValid=function(e){if(!e||"string"!=typeof e)return!1;if(-1==e.indexOf("+"))return!1;if(e.indexOf("+")!=e.lastIndexOf("+"))return!1;if(1==e.length)return!1;if(e.indexOf("+")>8||e.indexOf("+")%2==1)return!1;if(e.indexOf("0")>-1){if(e.indexOf("+")<8)return!1;if(0==e.indexOf("0"))return!1;var t=e.match(new RegExp("(0+)","g"));if(t.length>1||t[0].length%2==1||t[0].length>6)return!1;if("+"!=e.charAt(e.length-1))return!1}if(e.length-e.indexOf("+")-1==1)return!1;for(var n=0,o=(e=e.replace(new RegExp("\\++"),"").replace(new RegExp("0+"),"")).length;n<o;n++){var i=e.charAt(n).toUpperCase();if("+"!=i&&-1==r.indexOf(i))return!1}return!0},h=e.isShort=function(e){return!!f(e)&&(e.indexOf("+")>=0&&e.indexOf("+")<8)},l=e.isFull=function(e){if(!f(e))return!1;if(h(e))return!1;if(r.indexOf(e.charAt(0).toUpperCase())*t>=180)return!1;if(e.length>1&&r.indexOf(e.charAt(1).toUpperCase())*t>=360)return!1;return!0},d=e.encode=function(n,i,f){if(n=Number(n),i=Number(i),f=void 0===f?e.CODE_PRECISION_NORMAL:Math.min(15,Number(f)),isNaN(n)||isNaN(i)||isNaN(f))throw new Error("ValueError: Parameters are not numbers");if(f<2||f<10&&f%2==1)throw new Error("IllegalArgumentException: Invalid Open Location Code length");n=c(n),i=g(i),90==n&&(n-=p(f));var h="";if(f>10)for(var l=Math.floor(Math.round((n-Math.floor(n))*a*1e6)/1e6),d=Math.floor(Math.round((i-Math.floor(i))*u*1e6)/1e6),s=0;s<5;s++){var M=4*Math.floor(l%5)+Math.floor(d%4);h=r.charAt(M)+h,l/=5,d/=4}for(l=Math.floor(Math.round((n+90)*o*1e6)/1e6),d=Math.floor(Math.round((i+180)*o*1e6)/1e6),s=0;s<5;s++)h=r.charAt(Math.floor(d%t))+h,h=r.charAt(Math.floor(l%t))+h,l/=t,d/=t,0==s&&(h="+"+h);return f>=8?h.substring(0,f+1):h.substring(0,f)+Array(8-f+1).join("0")+"+"},s=e.decode=function(e){if(!l(e))throw new Error("IllegalArgumentException: Passed Open Location Code is not a valid full code: "+e);e=e.replace("+","").replace(/0/g,"").toLocaleUpperCase("en-US");for(var i=-90*o,f=-180*o,h=0,d=0,s=Math.min(e.length,10),c=n,p=0;p<s;p+=2)i+=r.indexOf(e.charAt(p))*c,f+=r.indexOf(e.charAt(p+1))*c,p<s-2&&(c/=t);var g=c/o,C=c/o;if(e.length>10){var O=625,x=256;s=Math.min(e.length,15);for(p=10;p<s;p++){var E=r.indexOf(e.charAt(p));h+=Math.floor(E/4)*O,d+=E%4*x,p<s-1&&(O/=5,x/=4)}g=O/a,C=x/u}var m=i/o+h/a,w=f/o+d/u;return new M(Math.round(1e14*m)/1e14,Math.round(1e14*w)/1e14,Math.round(1e14*(m+g))/1e14,Math.round(1e14*(w+C))/1e14,Math.min(e.length,15))};e.recoverNearest=function(e,r,t){if(!h(e)){if(l(e))return e.toUpperCase();throw new Error("ValueError: Passed short code is not valid: "+e)}if(r=Number(r),t=Number(t),isNaN(r)||isNaN(t))throw new Error("ValueError: Reference position are not numbers");r=c(r),t=g(t);var n=8-(e=e.toUpperCase()).indexOf("+"),o=Math.pow(20,2-n/2),i=o/2,a=s(d(r,t).substr(0,n)+e);return r+i<a.latitudeCenter&&a.latitudeCenter-o>=-90?a.latitudeCenter-=o:r-i>a.latitudeCenter&&a.latitudeCenter+o<=90&&(a.latitudeCenter+=o),t+i<a.longitudeCenter?a.longitudeCenter-=o:t-i>a.longitudeCenter&&(a.longitudeCenter+=o),d(a.latitudeCenter,a.longitudeCenter,a.codeLength)},e.shorten=function(e,r,t){if(!l(e))throw new Error("ValueError: Passed code is not valid and full: "+e);if(-1!=e.indexOf("0"))throw new Error("ValueError: Cannot shorten padded codes: "+e);e=e.toUpperCase();var n=s(e);if(n.codeLength<6)throw new Error("ValueError: Code length must be at least 6");if(r=Number(r),t=Number(t),isNaN(r)||isNaN(t))throw new Error("ValueError: Reference position are not numbers");r=c(r),t=g(t);for(var o=Math.max(Math.abs(n.latitudeCenter-r),Math.abs(n.longitudeCenter-t)),a=i.length-2;a>=1;a--)if(o<.3*i[a])return e.substring(2*(a+1));return e};var c=function(e){return Math.min(90,Math.max(-90,e))},p=function(e){return e<=10?Math.pow(20,Math.floor(e/-2+2)):Math.pow(20,-3)/Math.pow(5,e-10)},g=function(e){for(;e<-180;)e+=360;for(;e>=180;)e-=360;return e},M=e.CodeArea=function(r,t,n,o,i){return new e.CodeArea.fn.Init(r,t,n,o,i)};return M.fn=M.prototype={Init:function(e,r,t,n,o){this.latitudeLo=e,this.longitudeLo=r,this.latitudeHi=t,this.longitudeHi=n,this.codeLength=o,this.latitudeCenter=Math.min(e+(t-e)/2,90),this.longitudeCenter=Math.min(r+(n-r)/2,180)}},M.fn.Init.prototype=M.fn,e});
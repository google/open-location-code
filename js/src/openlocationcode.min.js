!function(e,t){"function"==typeof define&&define.amd?define(["b"],function(r){return e.returnExportsGlobal=t()}):"object"==typeof module&&module.exports?module.exports=t(require("b")):e.OpenLocationCode=t()}(this,function(){var e={CODE_PRECISION_NORMAL:10,CODE_PRECISION_EXTRA:11},t="+",r="0",n="23456789CFGHJMPQRVWX",i=n.length,o=90,a=180,u=10,f=[20,1,.05,.0025,125e-6],l=125e-6,d=(e.getAlphabet=function(){return n},e.isValid=function(e){if(!e||"string"!=typeof e)return!1;if(-1==e.indexOf(t))return!1;if(e.indexOf(t)!=e.lastIndexOf(t))return!1;if(1==e.length)return!1;if(e.indexOf(t)>8||e.indexOf(t)%2==1)return!1;if(e.indexOf(r)>-1){if(0==e.indexOf(r))return!1;var i=e.match(new RegExp("(0+)","g"));if(i.length>1||i[0].length%2==1||i[0].length>6)return!1;if(e.charAt(e.length-1)!=t)return!1}if(e.length-e.indexOf(t)-1==1)return!1;for(var o=0,a=(e=e.replace(new RegExp("\\++"),"").replace(new RegExp("0+"),"")).length;o<a;o++){var u=e.charAt(o).toUpperCase();if(u!=t&&-1==n.indexOf(u))return!1}return!0}),h=e.isShort=function(e){return!!d(e)&&(e.indexOf(t)>=0&&e.indexOf(t)<8)},s=e.isFull=function(e){if(!d(e))return!1;if(h(e))return!1;if(n.indexOf(e.charAt(0).toUpperCase())*i>=180)return!1;if(e.length>1&&n.indexOf(e.charAt(1).toUpperCase())*i>=360)return!1;return!0},c=e.encode=function(t,r,n){if(t=Number(t),r=Number(r),n=void 0===n?e.CODE_PRECISION_NORMAL:Math.min(15,Number(n)),isNaN(t)||isNaN(r)||isNaN(n))throw"ValueError: Parameters are not numbers";if(n<2||n<u&&n%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";t=p(t),r=x(r),90==t&&(t-=C(n));var i=O(t,r,Math.min(n,u));return n>u&&(i+=N(t,r,n-u)),i},g=e.decode=function(e){if(!s(e))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+e;e=(e=(e=e.replace(t,"")).replace(new RegExp("0+"),"")).toUpperCase();var r=m(e.substring(0,u));if(e.length<=u)return r;var n=M(e.substring(u,15));return b(r.latitudeLo+n.latitudeLo,r.longitudeLo+n.longitudeLo,r.latitudeLo+n.latitudeHi,r.longitudeLo+n.longitudeHi,r.codeLength+n.codeLength)},p=(e.recoverNearest=function(e,r,n){if(!h(e)){if(s(e))return e;throw"ValueError: Passed short code is not valid: "+e}if(r=Number(r),n=Number(n),isNaN(r)||isNaN(n))throw"ValueError: Reference position are not numbers";r=p(r),n=x(n);var i=8-(e=e.toUpperCase()).indexOf(t),a=Math.pow(20,2-i/2),u=a/2,f=g(c(r,n).substr(0,i)+e);return r+u<f.latitudeCenter&&f.latitudeCenter-a>=-o?f.latitudeCenter-=a:r-u>f.latitudeCenter&&f.latitudeCenter+a<=o&&(f.latitudeCenter+=a),n+u<f.longitudeCenter?f.longitudeCenter-=a:n-u>f.longitudeCenter&&(f.longitudeCenter+=a),c(f.latitudeCenter,f.longitudeCenter,f.codeLength)},e.shorten=function(e,t,n){if(!s(e))throw"ValueError: Passed code is not valid and full: "+e;if(-1!=e.indexOf(r))throw"ValueError: Cannot shorten padded codes: "+e;e=e.toUpperCase();var i=g(e);if(i.codeLength<6)throw"ValueError: Code length must be at least 6";if(t=Number(t),n=Number(n),isNaN(t)||isNaN(n))throw"ValueError: Reference position are not numbers";t=p(t),n=x(n);for(var o=Math.max(Math.abs(i.latitudeCenter-t),Math.abs(i.longitudeCenter-n)),a=f.length-2;a>=1;a--)if(o<.3*f[a])return e.substring(2*(a+1));return e},function(e){return Math.min(90,Math.max(-90,e))}),C=function(e){return e<=10?Math.pow(20,Math.floor(e/-2+2)):Math.pow(20,-3)/Math.pow(5,e-10)},x=function(e){for(;e<-180;)e+=360;for(;e>=180;)e-=360;return e},O=function(e,i,u){for(var l="",d=e+o,h=i+a,s=0;s<u;){var c=f[Math.floor(s/2)],g=Math.floor(d/c);d-=g*c,l+=n.charAt(g),s+=1,h-=(g=Math.floor(h/c))*c,l+=n.charAt(g),8==(s+=1)&&s<u&&(l+=t)}return l.length<8&&(l+=Array(8-l.length+1).join(r)),8==l.length&&(l+=t),l},N=function(e,t,r){var i="",u=l,f=l;e+=o,t+=a;for(var d=(e%=1)%u,h=(t%=1)%f,s=0;s<r;s++){var c=Math.floor(d/(u/5)),g=Math.floor(h/(f/4));d-=c*(u/=5),h-=g*(f/=4),i+=n.charAt(4*c+g)}return i},m=function(e){var t=v(e,0),r=v(e,1);return new b(t[0]-o,r[0]-a,t[1]-o,r[1]-a,e.length)},v=function(e,t){for(var r=0,i=0;2*r+t<e.length;)i+=n.indexOf(e.charAt(2*r+t))*f[r],r+=1;return[i,i+f[r-1]]},M=function(e){for(var t=0,r=0,i=l,o=l,a=0;a<e.length;){var u=n.indexOf(e.charAt(a));t+=Math.floor(u/4)*(i/=5),r+=u%4*(o/=4),a+=1}return b(t,r,t+i,r+o,e.length)},b=e.CodeArea=function(t,r,n,i,o){return new e.CodeArea.fn.init(t,r,n,i,o)};return b.fn=b.prototype={init:function(e,t,r,n,i){this.latitudeLo=e,this.longitudeLo=t,this.latitudeHi=r,this.longitudeHi=n,this.codeLength=i,this.latitudeCenter=Math.min(e+(r-e)/2,o),this.longitudeCenter=Math.min(t+(n-t)/2,a)}},b.fn.init.prototype=b.fn,e});
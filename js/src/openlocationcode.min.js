!function(e,r){"function"==typeof define&&define.amd?define(function(){return e.returnExportsGlobal=r()}):"object"==typeof module&&module.exports?module.exports=r():e.OpenLocationCode=r()}(this,function(){var e={CODE_PRECISION_NORMAL:10,CODE_PRECISION_EXTRA:11},r="23456789CFGHJMPQRVWX",t=r.length,n=Math.pow(t,4),o=Math.pow(t,3),i=[20,1,.05,.0025,125e-6],a=Math.pow(5,4),u=Math.pow(4,4),f=o*Math.pow(5,5),h=o*Math.pow(4,5);e.getAlphabet=function(){return r};var l=e.isValid=function(e){if(!e||"string"!=typeof e)return!1;if(-1==e.indexOf("+"))return!1;if(e.indexOf("+")!=e.lastIndexOf("+"))return!1;if(1==e.length)return!1;if(e.indexOf("+")>8||e.indexOf("+")%2==1)return!1;if(e.indexOf("0")>-1){if(e.indexOf("+")<8)return!1;if(0==e.indexOf("0"))return!1;var t=e.match(new RegExp("(0+)","g"));if(t.length>1||t[0].length%2==1||t[0].length>6)return!1;if("+"!=e.charAt(e.length-1))return!1}if(e.length-e.indexOf("+")-1==1)return!1;for(var n=0,o=(e=e.replace(new RegExp("\\++"),"").replace(new RegExp("0+"),"")).length;n<o;n++){var i=e.charAt(n).toUpperCase();if("+"!=i&&-1==r.indexOf(i))return!1}return!0},d=e.isShort=function(e){return!!l(e)&&(e.indexOf("+")>=0&&e.indexOf("+")<8)},s=e.isFull=function(e){if(!l(e))return!1;if(d(e))return!1;if(r.indexOf(e.charAt(0).toUpperCase())*t>=180)return!1;if(e.length>1&&r.indexOf(e.charAt(1).toUpperCase())*t>=360)return!1;return!0},c=e.encode=function(n,o,i){if(n=Number(n),o=Number(o),i=void 0===i?e.CODE_PRECISION_NORMAL:Math.min(15,Number(i)),isNaN(n)||isNaN(o)||isNaN(i))throw new Error("ValueError: Parameters are not numbers");if(i<2||i<10&&i%2==1)throw new Error("IllegalArgumentException: Invalid Open Location Code length");var a=Math.round(n*f);(a+=90*f)<0?a=0:a>=180*f&&(a=180*f-1);var u=Math.round(o*h);(u+=180*h)<0?u=u%(360*h)+360*h:u>=360*h&&(u%=360*h);const l=new Array(16);if(l[8]="+",i>10)for(var d=5;d>=1;d--){var s=4*(a%5)+u%4;l[10+d]=r.charAt(s),a=Math.floor(a/5),u=Math.floor(u/4)}else a=Math.floor(a/Math.pow(5,5)),u=Math.floor(u/Math.pow(4,5));l[9]=r.charAt(a%t),l[10]=r.charAt(u%t),a=Math.floor(a/t),u=Math.floor(u/t);for(d=6;d>=0;d-=2)l[d]=r.charAt(a%t),l[d+1]=r.charAt(u%t),a=Math.floor(a/t),u=Math.floor(u/t);return i>=8?l.slice(0,i+1).join(""):l.slice(0,i).join("")+Array(8-i+1).join("0")+"+"},p=e.decode=function(e){if(!s(e))throw new Error("IllegalArgumentException: Passed Plus Code is not a valid full code: "+e);e=e.replace("+","").replace(/0/g,"").toLocaleUpperCase("en-US");for(var i=-90*o,l=-180*o,d=0,c=0,p=Math.min(e.length,10),g=n,M=0;M<p;M+=2)i+=r.indexOf(e.charAt(M))*g,l+=r.indexOf(e.charAt(M+1))*g,M<p-2&&(g/=t);var w=g/o,x=g/o;if(e.length>10){var E=a,O=u;p=Math.min(e.length,15);for(M=10;M<p;M++){var m=r.indexOf(e.charAt(M));d+=Math.floor(m/4)*E,c+=m%4*O,M<p-1&&(E/=5,O/=4)}w=E/f,x=O/h}var N=i/o+d/f,v=l/o+c/h;return new C(Math.round(1e14*N)/1e14,Math.round(1e14*v)/1e14,Math.round(1e14*(N+w))/1e14,Math.round(1e14*(v+x))/1e14,Math.min(e.length,15))};e.recoverNearest=function(e,r,t){if(!d(e)){if(s(e))return e.toUpperCase();throw new Error("ValueError: Passed short code is not valid: "+e)}if(r=Number(r),t=Number(t),isNaN(r)||isNaN(t))throw new Error("ValueError: Reference position are not numbers");r=g(r),t=M(t);var n=8-(e=e.toUpperCase()).indexOf("+"),o=Math.pow(20,2-n/2),i=o/2,a=p(c(r,t).substr(0,n)+e);return r+i<a.latitudeCenter&&a.latitudeCenter-o>=-90?a.latitudeCenter-=o:r-i>a.latitudeCenter&&a.latitudeCenter+o<=90&&(a.latitudeCenter+=o),t+i<a.longitudeCenter?a.longitudeCenter-=o:t-i>a.longitudeCenter&&(a.longitudeCenter+=o),c(a.latitudeCenter,a.longitudeCenter,a.codeLength)},e.shorten=function(e,r,t){if(!s(e))throw new Error("ValueError: Passed code is not valid and full: "+e);if(-1!=e.indexOf("0"))throw new Error("ValueError: Cannot shorten padded codes: "+e);e=e.toUpperCase();var n=p(e);if(n.codeLength<6)throw new Error("ValueError: Code length must be at least 6");if(r=Number(r),t=Number(t),isNaN(r)||isNaN(t))throw new Error("ValueError: Reference position are not numbers");r=g(r),t=M(t);for(var o=Math.max(Math.abs(n.latitudeCenter-r),Math.abs(n.longitudeCenter-t)),a=i.length-2;a>=1;a--)if(o<.3*i[a])return e.substring(2*(a+1));return e};var g=function(e){return Math.min(90,Math.max(-90,e))},M=function(e){for(;e<-180;)e+=360;for(;e>=180;)e-=360;return e},C=e.CodeArea=function(r,t,n,o,i){return new e.CodeArea.fn.Init(r,t,n,o,i)};return C.fn=C.prototype={Init:function(e,r,t,n,o){this.latitudeLo=e,this.longitudeLo=r,this.latitudeHi=t,this.longitudeHi=n,this.codeLength=o,this.latitudeCenter=Math.min(e+(t-e)/2,90),this.longitudeCenter=Math.min(r+(n-r)/2,180)}},C.fn.Init.prototype=C.fn,e});